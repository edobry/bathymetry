<!DOCTYPE HTML>
<html>
    <head>
        <title>transects</title>

        <link href="../node_modules/c3/c3.css" rel="stylesheet">
        <script
            src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>
        <script src="https://d3js.org/d3.v3.min.js"></script>
        <script src="../node_modules/c3/c3.js"></script>
        <style type="text/css">
            .c3-target-floor .c3-areas-floor path {
                opacity: 1 !important;
                fill: rgb(126, 125, 106) !important;
            }

            .c3-target-floor .c3-circles-floor circle {
                fill: rgb(196, 195, 166) !important;
            }

            .c3-target-floor .c3-lines-floor path {
                stroke: rgb(196, 195, 166) !important;
            }
        </style>
    </head>
    <body>
        <div id="chart"></div>

        <script type="text/javascript">
            const byField = field => (a, b) =>
                a[field] - b[field];

            fetch("./transect1.json", { method: "get" })
                .then(response =>
                    response.json())
                .then(data => {
                    return drawChart(data);
                })
                .catch(err => {
                    throw new Error(err);
                });

            const drawChart = ({ bands, floor }) => {
                const bandRows = Object.entries(bands)
                    .map(([name, points]) => [
                        name, ...Object.entries(points)
                            .sort(byField(0))
                            .map(([dist, depth]) =>
                                depth)
                    ]);

                console.log(bandRows);

                const bandNames = bandRows.map(([name]) => name);

                console.log(bandNames);

                const floorVals = Object.values(floor).filter(depth => depth < 800).map(x => 800-x);

                const entriesToMap = (map, [key, value]) => {
                    map[key] = value;
                    return map;
                };

                const xVals = Object.keys(floor).map(parseFloat);

                const config = {
                    bindto: "#chart",
                    size: {
                        height: 500
                    },
                    data: {
                        x: "x",
                        columns: [
                            ["x", ...xVals],
                            ["surface", ...xVals.map(x => 800)],
                            ...bandRows,
                            ["floor", ...floorVals]
                        ],
                        order: false,
                        // order: (a, b) => {
                        //     console.log(a,b);
                        //     return parseInt(a.id) - parseInt(b.id);
                        // },
                        // "line", "spline", "step", "area", "area-step" are also available to stack
                        types: [
                            ["floor", "area"],
                            ...bandNames.map(name => [name, "area"])
                        ].reduce(entriesToMap, {}),
                        groups: [[...bandNames]],
                        // color: (color, d) => {
                        //     console.log(color, d);
                        //     console.log(`#${Math.floor(parseInt(d.id) / 26)*10}FFFF`);
                        //     return d == "id" || d.id == "floor"
                        //         ? color
                        //         : `#${Math.floor(parseInt(d.id) / 26)*10}FFFF`
                        // }


                    },
                    // area: {
                    //     zerobased: false
                    // },
                    axis: {
                        y: {
                            // inverted: true
                            tick: {
                                format: d =>
                                    parseInt(d)-800
                            }

                        }
                    }
                };

                console.log(config);

                var chart = c3.generate(config);
            };

            // $(".c3-target-floor path").css({
            //     opacity: 1,
            //     fill: "#7e7d6a"
            // });
            //
            // $(".c3-circles-floor circle").css({
            //     fill: "#c4c3a6"
            // });
            // $(".c3-lines-floor path").css({
            //     stroke: "#c4c3a6"
            // });
        </script>
    </body>
</html>
